<%
const demoStyles = `
  /* Demo Form Styles */
  .demo-form-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .demo-form-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
  }

  .consent-checkbox {
    appearance: none;
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid #D1D5DB;
    border-radius: 4px;
    cursor: pointer;
    position: relative;
    transition: all 0.15s ease;
  }
  .consent-checkbox:checked {
    background-color: #FFBA49;
    border-color: #FFBA49;
  }
  .consent-checkbox:checked::after {
    content: '';
    position: absolute;
    left: 6px;
    top: 2px;
    width: 5px;
    height: 10px;
    border: solid #500B42;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }
  .consent-checkbox:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 186, 73, 0.3);
  }

  .sms-bubble {
    position: relative;
  }
  .sms-bubble::before {
    content: '';
    position: absolute;
    left: -8px;
    top: 12px;
    border-width: 8px;
    border-style: solid;
    border-color: transparent #E5E7EB transparent transparent;
  }

  /* Error states */
  .input-error {
    border-color: #EF4444 !important;
    background-color: rgba(239, 68, 68, 0.05);
  }
  .error-message {
    display: none;
    color: #EF4444;
    font-size: 13px;
    margin-top: 4px;
  }
  .error-message.show {
    display: block;
  }
`;
%>
<%- include('partials/head', {
  title: 'Demo: SMS Consent Collection - MoreStars',
  description: 'Demo: SMS Consent Collection Flow - See how MoreStars-powered businesses collect SMS consent from customers'
}) %>
  <style><%= demoStyles %></style>
  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" integrity="sha384-d+vyQ0dYcymoP8ndq2hW7FGC50nqGdXUEgoOUGxbbkAJwZqL7h+jKN0GGgn9hFDS" crossorigin="anonymous" defer></script>

  <% const activePage = 'demo'; %>
  <%- include('partials/navbar') %>

  <main>
    <!-- Hero Section -->
    <section class="pt-24 pb-12 bg-gray-50 border-b border-gray-200">
      <div class="max-w-4xl mx-auto px-4 text-center">
        <h1 class="text-4xl md:text-5xl font-extrabold mb-6 font-title text-brand-dark">
          SMS Consent Demo
        </h1>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          See how MoreStars-powered businesses collect SMS consent from customers.
        </p>
      </div>
    </section>

    <!-- Demo Content -->
    <section class="py-12 md:py-20 bg-white">
      <div class="max-w-2xl mx-auto px-4 sm:px-6">

        <!-- Demo Banner -->
        <div class="bg-[#F9F7FA] border border-[rgba(161,67,142,0.2)] rounded-2xl p-5 mb-8 text-center">
          <p class="text-[#500B42] font-medium text-sm">
            This is a demonstration of how MoreStars-powered businesses collect SMS consent. This form does not send real messages.
          </p>
        </div>

        <!-- Demo Form Card -->
        <div class="demo-form-card bg-white border border-gray-200 rounded-3xl p-8 shadow-lg mb-10">

          <form id="demoForm">
            <!-- Form Header -->
            <div class="text-center mb-8 pb-6 border-b border-gray-100">
              <div class="text-4xl mb-3">&#9986;</div>
              <h2 class="text-2xl font-bold text-brand-dark mb-1">Joe's Barbershop</h2>
              <p class="text-gray-500 text-sm">Book an Appointment</p>
            </div>

            <!-- Customer Name -->
            <div class="mb-5">
              <label for="customerName" class="block text-sm font-semibold text-gray-700 mb-2">
                Customer Name <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="customerName"
                name="customerName"
                placeholder="John Smith"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold focus:border-brand-gold transition-all"
                required
              >
              <div class="error-message" id="nameError">Please enter your name</div>
            </div>

            <!-- Phone Number -->
            <div class="mb-5">
              <label for="phoneNumber" class="block text-sm font-semibold text-gray-700 mb-2">
                Phone Number <span class="text-red-500">*</span>
              </label>
              <input
                type="tel"
                id="phoneNumber"
                name="phoneNumber"
                placeholder="(555) 123-4567"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold focus:border-brand-gold transition-all"
                required
              >
              <div class="error-message" id="phoneError">Please enter a valid phone number</div>
            </div>

            <!-- Email (Optional) -->
            <div class="mb-5">
              <label for="email" class="block text-sm font-medium text-gray-500 mb-2">
                Email <span class="text-gray-400 text-xs">(optional)</span>
              </label>
              <input
                type="email"
                id="email"
                name="email"
                placeholder="john@example.com"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold focus:border-brand-gold transition-all"
              >
              <div class="error-message" id="emailError">Please enter a valid email address</div>
            </div>

            <!-- Service Selection -->
            <div class="mb-6">
              <label for="service" class="block text-sm font-semibold text-gray-700 mb-2">
                Select a Service <span class="text-red-500">*</span>
              </label>
              <select
                id="service"
                name="service"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold focus:border-brand-gold transition-all bg-white"
                required
              >
                <option value="">Choose a service...</option>
                <option value="haircut">Classic Haircut</option>
                <option value="fade">Fade</option>
                <option value="beard">Beard Trim</option>
                <option value="lineup">Line Up</option>
                <option value="full-service">Full Service (Haircut + Beard)</option>
                <option value="kids">Kids Haircut</option>
              </select>
              <div class="error-message" id="serviceError">Please select a service</div>
            </div>

            <!-- Consent Section -->
            <div class="bg-gray-50 border-2 border-gray-200 rounded-2xl p-5 mb-6">
              <h3 class="font-bold text-gray-800 mb-4 text-sm">Feedback Consent</h3>
              <div class="flex items-start gap-3">
                <input
                  type="checkbox"
                  id="smsConsent"
                  name="smsConsent"
                  class="consent-checkbox mt-1 flex-shrink-0"
                  required
                >
                <label for="smsConsent" class="text-sm text-gray-600 leading-relaxed cursor-pointer">
                  I agree to receive marketing messages from Joe's Barbershop, including a one-time review request after my visit. Message and data rates may apply. Reply STOP to opt out.
                  <a href="/terms" target="_blank" class="text-[#A1438E] hover:underline font-medium">Terms</a> |
                  <a href="/privacy" target="_blank" class="text-[#A1438E] hover:underline font-medium">Privacy</a>
                </label>
              </div>
              <div class="error-message mt-2" id="consentError">You must agree to receive an SMS review request</div>
            </div>

            <!-- Form Actions -->
            <div class="flex gap-3">
              <button
                type="submit"
                class="flex-1 py-4 px-6 bg-brand-gold text-brand-dark font-bold rounded-xl hover:bg-yellow-400 transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5"
              >
                Book Appointment & Opt In
              </button>
              <button
                type="reset"
                class="py-4 px-6 border-2 border-gray-300 text-gray-600 font-semibold rounded-xl hover:bg-gray-50 transition-all"
              >
                Clear
              </button>
            </div>
          </form>

          <!-- Confirmation Screen (Hidden by default) -->
          <div id="confirmationScreen" class="hidden">
            <div class="text-center">
              <div class="text-6xl mb-4">&#9989;</div>
              <h2 class="text-2xl font-bold text-green-600 mb-2">Appointment Confirmed!</h2>
              <p class="text-gray-500 mb-8">Your appointment has been booked and your SMS consent has been recorded.</p>

              <!-- Consent Record -->
              <div class="bg-white border-2 border-green-200 rounded-2xl p-5 mb-6 text-left">
                <h4 class="font-bold text-gray-800 mb-4 pb-3 border-b border-gray-100 flex items-center gap-2">
                  <span>&#128203;</span> Consent Record
                </h4>
                <div class="space-y-3 text-sm">
                  <div class="flex gap-4">
                    <span class="font-semibold text-gray-500 min-w-[100px]">Timestamp:</span>
                    <span class="text-gray-800" id="recordTimestamp">-</span>
                  </div>
                  <div class="flex gap-4">
                    <span class="font-semibold text-gray-500 min-w-[100px]">Phone:</span>
                    <span class="text-gray-800" id="recordPhone">-</span>
                  </div>
                  <div class="flex gap-4">
                    <span class="font-semibold text-gray-500 min-w-[100px]">Method:</span>
                    <span class="text-gray-800">Web Form</span>
                  </div>
                  <div class="flex gap-4">
                    <span class="font-semibold text-gray-500 min-w-[100px]">Consent Text:</span>
                    <span class="text-gray-800 text-xs leading-relaxed">I agree to receive marketing messages from Joe's Barbershop, including a one-time review request after my visit. Message and data rates may apply. Reply STOP to opt out.</span>
                  </div>
                </div>
              </div>

              <!-- SMS Mockup -->
              <div class="bg-white border border-gray-200 rounded-2xl p-5 mb-6 text-left">
                <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                  <span>&#128241;</span> Sample SMS They'll Receive
                </h4>
                <p class="text-xs text-gray-400 mb-2">Joe's Barbershop (Incoming Message)</p>
                <div class="sms-bubble bg-gray-200 rounded-2xl px-4 py-3 inline-block max-w-[90%] text-sm text-gray-800 leading-relaxed">
                  Hi <span id="smsName">John</span>! Thanks for visiting Joe's Barbershop. We'd love your feedback: <a href="https://g.page/r/CVASdxR-ATBCEAE/review" target="_blank" class="text-[#A1438E] underline">https://g.page/r/...</a> Msg&data rates may apply. Reply STOP to opt out.
                </div>
              </div>

              <button
                type="button"
                onclick="resetDemo()"
                class="w-full py-4 px-6 border-2 border-gray-300 text-gray-600 font-semibold rounded-xl hover:bg-gray-50 transition-all"
              >
                Start Over
              </button>
            </div>
          </div>
        </div>

        <!-- Compliance Section -->
        <div class="bg-white border border-gray-200 rounded-3xl p-8 shadow-lg">
          <h2 class="text-xl font-bold text-brand-dark mb-6 pb-4 border-b border-gray-100 flex items-center gap-2">
            <span>&#128218;</span> For Compliance Reviewers
          </h2>

          <div class="space-y-6">
            <div>
              <h3 class="font-bold text-brand-gold mb-2">What This Demonstrates</h3>
              <p class="text-gray-600 text-sm leading-relaxed">
                This page shows how MoreStars-powered businesses collect SMS consent from customers before sending review requests. The form captures explicit consent with clear messaging about the review request, message rates, and opt-out instructions.
              </p>
            </div>

            <div>
              <h3 class="font-bold text-brand-gold mb-3">Consent Requirements</h3>
              <ul class="space-y-2">
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>Businesses collect explicit written consent (checkbox) before messaging</span>
                </li>
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>Consent language includes business identification and clear opt-out instructions</span>
                </li>
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>Message frequency is limited to one (1) per customer per 30 days</span>
                </li>
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>All messages include "Reply STOP to opt out" compliance language</span>
                </li>
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>Businesses maintain records of consent (timestamp, method, consent text)</span>
                </li>
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>Links to Terms of Service and Privacy Policy are provided during consent</span>
                </li>
              </ul>
            </div>

            <div>
              <h3 class="font-bold text-brand-gold mb-3">MoreStars Terms of Service</h3>
              <p class="text-gray-600 text-sm mb-3">All MoreStars subscribing businesses are contractually required to:</p>
              <ul class="space-y-2">
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>Obtain prior express written consent before submitting phone numbers</span>
                </li>
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>Use MoreStars-approved consent language (or substantially similar)</span>
                </li>
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>Maintain consent records for minimum 4 years</span>
                </li>
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>Comply with TCPA, CTIA guidelines, and carrier requirements</span>
                </li>
                <li class="flex items-start gap-2 text-sm text-gray-600">
                  <span class="text-green-500 font-bold">&#10003;</span>
                  <span>Respect customer opt-out requests immediately</span>
                </li>
              </ul>
            </div>

            <div class="pt-4 border-t border-gray-100">
              <p class="text-gray-600 text-sm font-medium mb-4">For full compliance documentation, carrier requirements, and regulatory information:</p>
              <a
                href="/sms-compliance"
                target="_blank"
                class="inline-block px-6 py-3 bg-brand-dark text-white font-semibold rounded-xl hover:bg-gray-800 transition-all"
              >
                View Full Compliance Documentation &rarr;
              </a>
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <%- include('partials/marketing-footer') %>

  <!-- Mega Menu & Form JavaScript -->
  <script<%- typeof cspNonce !== 'undefined' ? ` nonce="${cspNonce}"` : '' %>>
    // Mobile menu toggle
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobileMenu');
    const menuIcon = document.getElementById('menuIcon');
    const closeIcon = document.getElementById('closeIcon');

    if (hamburger && mobileMenu) {
      hamburger.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        menuIcon.classList.toggle('hidden');
        closeIcon.classList.toggle('hidden');
        if (!mobileMenu.classList.contains('hidden')) {
          mobileMenu.classList.add('mobile-menu-enter');
        }
      });
    }

    // Desktop Mega Menu
    const megaMenuTrigger = document.getElementById('industriesTrigger');
    const megaMenu = document.getElementById('industriesMegaMenu');

    if (megaMenuTrigger && megaMenu) {
      let menuTimeout;

      megaMenuTrigger.addEventListener('mouseenter', () => {
        clearTimeout(menuTimeout);
        megaMenu.classList.add('open');
        megaMenuTrigger.classList.add('active');
      });

      megaMenuTrigger.addEventListener('mouseleave', () => {
        menuTimeout = setTimeout(() => {
          megaMenu.classList.remove('open');
          megaMenuTrigger.classList.remove('active');
        }, 150);
      });

      megaMenu.addEventListener('mouseenter', () => {
        clearTimeout(menuTimeout);
      });

      megaMenu.addEventListener('mouseleave', () => {
        menuTimeout = setTimeout(() => {
          megaMenu.classList.remove('open');
          megaMenuTrigger.classList.remove('active');
        }, 150);
      });
    }

    // Mobile Industries Accordion
    const mobileIndustriesTrigger = document.getElementById('mobileIndustriesTrigger');
    const mobileIndustriesAccordion = document.getElementById('mobileIndustriesAccordion');
    const mobileIndustriesArrow = document.getElementById('mobileIndustriesArrow');

    if (mobileIndustriesTrigger && mobileIndustriesAccordion) {
      mobileIndustriesTrigger.addEventListener('click', () => {
        mobileIndustriesAccordion.classList.toggle('open');
        mobileIndustriesArrow.style.transform = mobileIndustriesAccordion.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
      });
    }

    // Form Submission Handler
    const demoForm = document.getElementById('demoForm');
    const confirmationScreen = document.getElementById('confirmationScreen');

    demoForm.addEventListener('submit', (e) => {
      e.preventDefault();

      // Clear previous errors
      clearErrors();

      // Validate form
      if (!validateForm()) {
        return;
      }

      // Get form data
      const name = document.getElementById('customerName').value;
      const phone = document.getElementById('phoneNumber').value;

      // Update confirmation screen
      const timestamp = new Date().toLocaleString('en-US', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });

      document.getElementById('recordTimestamp').textContent = timestamp;
      document.getElementById('recordPhone').textContent = phone;
      document.getElementById('smsName').textContent = name.split(' ')[0];

      // Show confirmation screen
      demoForm.classList.add('hidden');
      confirmationScreen.classList.remove('hidden');

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Form Validation
    function validateForm() {
      let isValid = true;
      const nameInput = document.getElementById('customerName');
      const phoneInput = document.getElementById('phoneNumber');
      const emailInput = document.getElementById('email');
      const serviceInput = document.getElementById('service');
      const consentInput = document.getElementById('smsConsent');

      // Name validation
      if (!nameInput.value.trim()) {
        showError('nameError', nameInput);
        isValid = false;
      }

      // Phone validation (basic)
      const phoneRegex = /^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/;
      if (!phoneInput.value.trim() || !phoneRegex.test(phoneInput.value.replace(/\D/g, ''))) {
        showError('phoneError', phoneInput);
        isValid = false;
      }

      // Email validation (if provided)
      if (emailInput.value.trim()) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailInput.value)) {
          showError('emailError', emailInput);
          isValid = false;
        }
      }

      // Service validation
      if (!serviceInput.value) {
        showError('serviceError', serviceInput);
        isValid = false;
      }

      // Consent validation
      if (!consentInput.checked) {
        showError('consentError', consentInput);
        isValid = false;
      }

      return isValid;
    }

    function showError(errorId, inputElement) {
      const errorElement = document.getElementById(errorId);
      errorElement.classList.add('show');
      inputElement.classList.add('input-error');
    }

    function clearErrors() {
      document.querySelectorAll('.error-message').forEach(el => {
        el.classList.remove('show');
      });
      document.querySelectorAll('.input-error').forEach(el => {
        el.classList.remove('input-error');
      });
    }

    function resetDemo() {
      demoForm.reset();
      demoForm.classList.remove('hidden');
      confirmationScreen.classList.add('hidden');
      clearErrors();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // GSAP Animation
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof gsap !== 'undefined') {
        gsap.from('.demo-form-card', {
          y: 30,
          opacity: 0,
          duration: 0.8,
          ease: 'power2.out',
          delay: 0.2
        });
      }
    });
  </script>

<%- include('partials/scripts') %>
