<%#
  Toast Notification Component

  A toast notification system for displaying feedback messages.

  Usage:
  1. Include this partial once in your layout (before </body>):
     <%- include('partials/toast') %>

  2. Show toasts via JavaScript:
     showToast('Your changes have been saved!', 'success');
     showToast('Something went wrong', 'error');
     showToast('Please wait...', 'info', { duration: 0 }); // No auto-dismiss

  Types: 'success' | 'error' | 'warning' | 'info'
  Options: { duration: 5000, dismissible: true }
%>

<!-- Toast Container -->
<div id="toast-container" class="toast-container" role="status" aria-live="polite" aria-atomic="true"></div>

<style>
  .toast-container {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: none;
    max-width: 400px;
  }

  @media (max-width: 480px) {
    .toast-container {
      bottom: 16px;
      right: 16px;
      left: 16px;
      max-width: none;
    }
  }

  .toast {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    border-radius: 12px;
    background: white;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 2px 10px rgba(0, 0, 0, 0.1);
    pointer-events: auto;
    animation: toast-slide-in 0.3s ease;
    border-left: 4px solid;
    max-width: 100%;
  }

  .toast.toast-exit {
    animation: toast-slide-out 0.2s ease forwards;
  }

  @keyframes toast-slide-in {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes toast-slide-out {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }

  .toast-success {
    border-color: #10B981;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, white 100%);
  }

  .toast-error {
    border-color: #EF4444;
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, white 100%);
  }

  .toast-warning {
    border-color: #F59E0B;
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, white 100%);
  }

  .toast-info {
    border-color: #3B82F6;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, white 100%);
  }

  .toast-icon {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .toast-success .toast-icon { color: #10B981; }
  .toast-error .toast-icon { color: #EF4444; }
  .toast-warning .toast-icon { color: #F59E0B; }
  .toast-info .toast-icon { color: #3B82F6; }

  .toast-content {
    flex: 1;
    min-width: 0;
  }

  .toast-message {
    font-size: 14px;
    font-weight: 500;
    color: #500B42;
    line-height: 1.5;
    word-wrap: break-word;
  }

  .toast-close {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    cursor: pointer;
    color: #9CA3AF;
    border-radius: 4px;
    transition: all 0.15s ease;
    padding: 0;
  }

  .toast-close:hover {
    background: rgba(0, 0, 0, 0.05);
    color: #6B7280;
  }

  .toast-close:focus {
    outline: 2px solid #FFBA49;
    outline-offset: 2px;
  }

  .toast-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    background: currentColor;
    opacity: 0.3;
    border-radius: 0 0 0 12px;
  }

  .toast-success .toast-progress { background: #10B981; }
  .toast-error .toast-progress { background: #EF4444; }
  .toast-warning .toast-progress { background: #F59E0B; }
  .toast-info .toast-progress { background: #3B82F6; }
</style>

<script<%- typeof cspNonce !== 'undefined' ? ` nonce="${cspNonce}"` : '' %>>
(function() {
  // Icons for each toast type
  const icons = {
    success: '<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
    error: '<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
    warning: '<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>',
    info: '<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
  };

  /**
   * Show a toast notification
   * @param {string} message - The message to display
   * @param {string} type - 'success' | 'error' | 'warning' | 'info'
   * @param {Object} options - { duration: 5000, dismissible: true }
   */
  window.showToast = function(message, type = 'info', options = {}) {
    const container = document.getElementById('toast-container');
    if (!container) return;

    const { duration = 5000, dismissible = true } = options;

    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.setAttribute('role', 'alert');
    toast.style.position = 'relative';

    // Build toast HTML
    toast.innerHTML = `
      <div class="toast-icon">${icons[type] || icons.info}</div>
      <div class="toast-content">
        <p class="toast-message">${escapeHtml(message)}</p>
      </div>
      ${dismissible ? `
        <button class="toast-close" aria-label="Dismiss notification">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      ` : ''}
      ${duration > 0 ? '<div class="toast-progress"></div>' : ''}
    `;

    // Add close button handler
    if (dismissible) {
      toast.querySelector('.toast-close').addEventListener('click', () => dismissToast(toast));
    }

    // Add progress bar animation
    if (duration > 0) {
      const progress = toast.querySelector('.toast-progress');
      if (progress) {
        progress.style.width = '100%';
        progress.style.transition = `width ${duration}ms linear`;
        requestAnimationFrame(() => {
          progress.style.width = '0%';
        });
      }
    }

    // Add to container
    container.appendChild(toast);

    // Auto-dismiss
    if (duration > 0) {
      setTimeout(() => dismissToast(toast), duration);
    }

    return toast;
  };

  /**
   * Dismiss a toast with animation
   */
  function dismissToast(toast) {
    if (!toast || toast.classList.contains('toast-exit')) return;

    toast.classList.add('toast-exit');
    setTimeout(() => {
      if (toast.parentNode) {
        toast.parentNode.removeChild(toast);
      }
    }, 200);
  }

  /**
   * Escape HTML to prevent XSS
   */
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  /**
   * Clear all toasts
   */
  window.clearToasts = function() {
    const container = document.getElementById('toast-container');
    if (container) {
      container.innerHTML = '';
    }
  };
})();
</script>
