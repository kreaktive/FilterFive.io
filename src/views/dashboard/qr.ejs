<%- include('../partials/dashboard-head', { title: title }) %>
  <style>
    /* QR Card - uses unified card system */
    .qr-card {
      background: var(--bg-white);
      border-radius: var(--radius-xl);
      padding: var(--space-10);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-light);
      text-align: center;
    }

    .qr-card h2 {
      font-size: var(--text-3xl);
      color: var(--text-primary);
      margin-bottom: var(--space-3);
    }

    .qr-card .subtitle {
      color: var(--text-secondary);
      margin-bottom: var(--space-8);
      font-size: var(--text-base);
    }

    .qr-image-container {
      background: var(--bg-white);
      padding: var(--space-8);
      border-radius: var(--radius-lg);
      border: 3px dashed var(--border-light);
      margin-bottom: var(--space-8);
      display: inline-block;
    }

    .qr-image {
      width: 300px;
      height: 300px;
      display: block;
    }

    .qr-url {
      background: var(--bg-light);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: var(--space-4);
      margin-bottom: var(--space-8);
      font-family: monospace;
      color: var(--text-secondary);
      word-break: break-all;
    }

    .button-group {
      display: flex;
      gap: var(--space-4);
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Buttons - uses unified button system */
    .btn {
      padding: var(--space-3) var(--space-8);
      border-radius: var(--radius-md);
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      border: none;
      font-size: var(--text-base);
      transition: all var(--transition-base);
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .btn-primary {
      background: var(--brand-gold);
      color: var(--brand-dark);
    }

    .btn-primary:hover {
      background: var(--brand-dark);
      color: white;
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--bg-white);
      color: var(--text-secondary);
      border: 2px solid var(--border-light);
    }

    .btn-secondary:hover {
      border-color: var(--brand-gold);
      color: var(--brand-gold);
    }

    .instructions {
      margin-top: var(--space-10);
      text-align: left;
      background: var(--bg-light);
      padding: var(--space-6);
      border-radius: var(--radius-lg);
    }

    .instructions h3 {
      color: var(--text-primary);
      margin-bottom: var(--space-4);
      font-size: var(--text-xl);
    }

    .instructions ol {
      margin-left: var(--space-5);
      line-height: 1.8;
      color: var(--text-secondary);
    }

    .instructions li {
      margin-bottom: var(--space-3);
    }

    /* Placement Tips */
    .placement-tips {
      margin-top: var(--space-6);
      background: linear-gradient(135deg, #fef3c7 0%, #fef9c3 100%);
      border: 1px solid #fcd34d;
      border-radius: var(--radius-lg);
      padding: var(--space-5);
    }

    .placement-tips h4 {
      color: #92400e;
      font-size: var(--text-base);
      font-weight: 700;
      margin-bottom: var(--space-3);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .placement-tips ul {
      margin: 0;
      padding-left: var(--space-5);
      color: #78350f;
      font-size: var(--text-sm);
      line-height: 1.6;
    }

    .placement-tips li {
      margin-bottom: var(--space-2);
    }

    .placement-tips li:last-child {
      margin-bottom: 0;
    }

    /* Test Scan Button */
    .btn-test {
      background: transparent;
      color: var(--brand-gold);
      border: 2px solid var(--brand-gold);
    }

    .btn-test:hover {
      background: var(--brand-gold);
      color: var(--brand-dark);
    }

    .btn-test svg {
      width: 16px;
      height: 16px;
      margin-right: var(--space-1);
      vertical-align: middle;
    }

    .success-message {
      background: #c6f6d5;
      color: #22543d;
      padding: var(--space-3) var(--space-5);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-5);
      display: none;
    }

    .success-message.show {
      display: block;
    }

    @media print {
      .header, .button-group, .instructions {
        display: none;
      }

      .qr-card {
        box-shadow: none;
        page-break-inside: avoid;
      }

      .qr-url {
        font-size: 14px;
      }
    }

    @media (max-width: 768px) {
      .qr-image {
        width: 250px;
        height: 250px;
      }

      .button-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <%- include('../partials/dashboard-header', { activePage: 'qr' }) %>

  <main id="main-content" class="container">
    <div class="qr-card">
      <h2>Your Feedback QR Code</h2>
      <p class="subtitle">Customers can scan this to leave instant feedback</p>

      <div id="successMessage" class="success-message"></div>

      <div class="qr-image-container">
        <img src="<%= qrCodeImage %>" alt="QR Code" class="qr-image" id="qrImage">
      </div>

      <div class="qr-url" id="qrUrl"><%= qrUrl %></div>

      <div class="button-group">
        <button class="btn btn-primary" onclick="downloadQR()">Download QR Code</button>
        <button class="btn btn-secondary" onclick="copyUrl()">Copy Link</button>
        <button class="btn btn-test" onclick="testScan()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
          Test Scan
        </button>
        <button class="btn btn-secondary" onclick="window.print()">Print</button>
      </div>

      <div class="instructions">
        <h3>How to use your QR code:</h3>
        <ol>
          <li><strong>Download</strong> the QR code image above</li>
          <li><strong>Print it</strong> or display it digitally at your location</li>
          <li><strong>Place it</strong> where customers can easily see it (checkout counter, table tents, receipts)</li>
          <li><strong>Customers scan</strong> with their phone camera</li>
          <li><strong>They rate</strong> their experience instantly - no phone number needed!</li>
        </ol>

        <div class="placement-tips">
          <h4>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            Pro Printing Tips
          </h4>
          <ul>
            <li><strong>Minimum size:</strong> Print at 1.5" Ã— 1.5" or larger for easy scanning</li>
            <li><strong>Best placement:</strong> Eye-level near checkout, on receipts, or table tents</li>
            <li><strong>Good lighting:</strong> Avoid glossy surfaces that cause glare</li>
            <li><strong>Test first:</strong> Use the "Test Scan" button to verify your link works</li>
          </ul>
        </div>
      </div>
    </div>
  </main>

  <script<%- typeof cspNonce !== 'undefined' ? ` nonce="${cspNonce}"` : '' %>>
    function downloadQR() {
      var link = document.createElement('a');
      link.download = '<%= businessName.replace(/[^a-z0-9]/gi, '_') %>_QR_Code.png';
      link.href = '<%= qrCodeImage %>';
      link.click();

      showSuccess('QR Code downloaded! Ready to print.');
    }

    function copyUrl() {
      var url = document.getElementById('qrUrl').textContent;
      navigator.clipboard.writeText(url).then(function() {
        showSuccess('Link copied! Paste it anywhere to share.');
      }).catch(function(err) {
        console.error('Failed to copy:', err);
        // Fallback for older browsers
        var textArea = document.createElement('textarea');
        textArea.value = url;
        textArea.style.position = 'fixed';
        textArea.style.left = '-9999px';
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          showSuccess('Link copied! Paste it anywhere to share.');
        } catch (e) {
          showError('Could not copy link. Please select and copy manually.');
        }
        document.body.removeChild(textArea);
      });
    }

    function testScan() {
      var url = document.getElementById('qrUrl').textContent;
      window.open(url, '_blank');
      showSuccess('Opening your feedback page in a new tab...');
    }

    function showSuccess(message) {
      var successMsg = document.getElementById('successMessage');
      successMsg.textContent = message;
      successMsg.style.background = '#c6f6d5';
      successMsg.style.color = '#22543d';
      successMsg.classList.add('show');

      setTimeout(function() {
        successMsg.classList.remove('show');
      }, 3000);
    }

    function showError(message) {
      var successMsg = document.getElementById('successMessage');
      successMsg.textContent = message;
      successMsg.style.background = '#fed7d7';
      successMsg.style.color = '#9b2c2c';
      successMsg.classList.add('show');

      setTimeout(function() {
        successMsg.classList.remove('show');
      }, 4000);
    }
  </script>

  <%- include('../partials/dashboard-footer') %>
  <script src="/js/dashboard-menu.min.js?v=<%= typeof assetVersion !== 'undefined' ? assetVersion : '1.0.0' %>"></script>
</body>
</html>
