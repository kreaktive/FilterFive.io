!function(){"use strict";var e=document.getElementById("stripe-key"),t=e?e.value:null;if(t){Stripe(t);document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("btn-monthly"),t=document.getElementById("btn-annual"),n=document.getElementById("btn-cancel"),o=document.getElementById("btn-reactivate");e&&e.addEventListener("click",function(){d("monthly",this)}),t&&t.addEventListener("click",function(){d("annual",this)}),n&&n.addEventListener("click",l),o&&o.addEventListener("click",s)})}else console.warn("Stripe key not found");function n(){var e=document.getElementById("csrf-token");return e?e.value:""}function o(){var e=document.getElementById("loading");e&&(e.style.display="block")}function i(){var e=document.getElementById("loading");e&&(e.style.display="none")}function r(e,t,n){openModal("success",{title:e,content:'<div style="text-align: center;"><div style="width: 64px; height: 64px; margin: 0 auto 16px; background: #D1FAE5; border-radius: 50%; display: flex; align-items: center; justify-content: center;"><svg width="32" height="32" fill="none" stroke="#10B981" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></div><p>'+t+"</p></div>",actions:[{text:"Got it",variant:"primary",onClick:function(){closeModal(),n&&n()}}],size:"sm"})}function c(e,t,n){openModal("error",{title:e,content:'<div style="text-align: center;"><div style="width: 64px; height: 64px; margin: 0 auto 16px; background: #FEE2E2; border-radius: 50%; display: flex; align-items: center; justify-content: center;"><svg width="32" height="32" fill="none" stroke="#EF4444" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></div><p>'+t+"</p></div>",actions:[{text:"Close",variant:"secondary",onClick:function(){closeModal()}},{text:"Try Again",variant:"primary",onClick:function(){closeModal(),n&&n()}}],size:"sm"})}function a(e,t){var n=document.querySelector(".status-card:last-of-type");if(n){var o=document.getElementById("btn-cancel"),i=document.getElementById("btn-reactivate"),r=n.querySelector("p:last-of-type");if("cancelled"===e){if(o&&(o.style.display="none"),i)i.style.display="block";else(i=document.createElement("button")).className="btn-reactivate",i.id="btn-reactivate",i.textContent="Reactivate Subscription",i.addEventListener("click",s),(c=n.querySelector(".btn-portal"))&&c.parentNode.insertBefore(i,c.nextSibling);r&&(r.textContent="Your subscription is scheduled to cancel on "+t+". Click above to keep your subscription active.")}else if("active"===e){var c;if(i&&(i.style.display="none"),o)o.style.display="block",o.setAttribute("data-period-end",t);else(o=document.createElement("button")).className="btn-cancel",o.id="btn-cancel",o.textContent="Cancel Subscription",o.setAttribute("data-period-end",t),o.addEventListener("click",l),(c=n.querySelector(".btn-portal"))&&c.parentNode.insertBefore(o,c.nextSibling);r&&(r.textContent="Cancelling will disable your subscription at the end of the current billing period.")}}}function l(){var e=document.getElementById("btn-cancel"),t=e?e.getAttribute("data-period-end"):"";!function(e){var t=document.getElementById("btn-cancel"),n=t?t.getAttribute("data-period-end"):"";openModal("cancel-subscription",{title:"Cancel Subscription",content:"<p>Are you sure you want to cancel your subscription?</p><p>You will continue to have full access until <strong>"+(n||"the end of your billing period")+'</strong>. After that date, your account will revert to the free tier.</p><p style="margin-top: 16px; padding: 12px; background: #FEF3C7; border-radius: 8px; font-size: 14px;"><strong>Note:</strong> You can reactivate your subscription anytime before '+(n||"the end date")+".</p>",actions:[{text:"Keep Subscription",variant:"secondary",onClick:function(){closeModal()}},{text:"Cancel Subscription",variant:"danger",onClick:e}],size:"sm"})}(function(){closeModal(),o(),fetch("/dashboard/subscription/cancel-subscription",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":n()},body:JSON.stringify({immediately:!1})}).then(function(e){return e.json()}).then(function(e){i(),e.success?r("Subscription Cancelled","Your subscription has been cancelled. You'll continue to have full access until <strong>"+t+"</strong>.",function(){a("cancelled",t)}):c("Cancellation Failed",e.error||"Something went wrong. Please try again.",l)}).catch(function(e){i(),console.error("Error:",e),c("Cancellation Failed","A network error occurred. Please check your connection and try again.",l)})})}function s(){var e=document.getElementById("btn-cancel"),t=e?e.getAttribute("data-period-end"):"";openModal("reactivate-subscription",{title:"Reactivate Subscription",content:"<p>Would you like to reactivate your subscription?</p><p>Your subscription will continue as normal and you won't lose any access.</p>",actions:[{text:"Cancel",variant:"secondary",onClick:function(){closeModal()}},{text:"Reactivate",variant:"primary",onClick:function(){closeModal(),o(),fetch("/dashboard/subscription/reactivate",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":n()},body:JSON.stringify({})}).then(function(e){return e.json()}).then(function(e){i(),e.success?r("Subscription Reactivated","Great news! Your subscription is now active again. You'll continue to be billed normally.",function(){a("active",t)}):c("Reactivation Failed",e.error||"Something went wrong. Please try again.",s)}).catch(function(e){i(),console.error("Error:",e),c("Reactivation Failed","A network error occurred. Please check your connection and try again.",s)})}}],size:"sm"})}function d(e,t){t.disabled=!0,t.innerHTML="Processing...",o(),fetch("/dashboard/subscription/checkout",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":n()},body:JSON.stringify({plan:e})}).then(function(e){return e.json()}).then(function(n){n.success?window.location.href=n.url:(c("Checkout Error",n.error||"Failed to start checkout. Please try again.",function(){d(e,t)}),u(t,e),i())}).catch(function(n){console.error("Error:",n),c("Checkout Error","A network error occurred. Please try again.",function(){d(e,t)}),u(t,e),i()})}function u(e,t){e.disabled=!1;e.innerHTML=("monthly"===t?"Subscribe Monthly ":"Subscribe Annually ")+'<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width:20px;height:20px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>'}}();